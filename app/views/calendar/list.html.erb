<% title("PBC - " + @date.strftime("%B %Y")) -%>

<section>
  
  <% if @page -%>
    <%= render :partial => 'pages/header',
      :locals => {:active_aspect => 'calendar'} %>
  <% elsif @resource -%>
    <%= render :partial => 'resources/header',
      :locals => {:active_aspect => 'calendar'} %>
  <% end -%>
  
  <%= render :partial => 'controls', :locals => {:view => 'list'} %>

<table id="calendar_list">
  <% prior_day = nil -%>
  <% @events.each do |event| -%>
    <% new_day = prior_day != event.start_at.day -%>
  <tr class="<%= new_day ? 'new_day' : '' %>">
    <td class="day">
      <% if new_day -%>
        <%= event.start_at.day.ordinalize %>
      <% end -%>
    </td>
    <td class="week_day">
      <% if new_day -%>
        <%= event.start_at.strftime("%A") %>
      <% end -%>
    </td>
    <td class="time"><%= event.start_at.simple_time %></td>
    <% if @full -%>
    <td class="time">- <%= event.stop_at.simple_time %></td>
    <% end -%>
    <td class="name"><%= link_to event.name,
      friendly_page_path(event.page) %></td>
    <td>
      <% if event.name != event.page.name and
        (not @page or event.page != @page) -%>
        <%= h(event.page.name) %>
      <% end -%>
    </td>
    <% if @full -%>
    <td>
      <%= event.reservations.map{|r| r.resource.name}.join(', ') %>
    </td>
    <% end -%>
  </tr>
  <% prior_day = event.start_at.day -%>
  <% end -%>
</table>

<% if @events.empty? -%>
<p class="empty_indicator">No events</p>
<% end -%>

</section>
