<% title("PBC - " + @date.strftime("%B %Y")) -%>

<section>
  
  <% if @page -%>
    <%= render :partial => 'pages/header',
      :locals => {:active_aspect => 'calendar'} %>
  <% elsif @resource -%>
    <%= render :partial => 'resources/header',
      :locals => {:active_aspect => 'calendar'} %>
  <% end -%>
  
  <%= render :partial => 'controls', :locals => {:view => 'grid'} %>
  
  <table id="calendar">

    <tr>
      <% %w(Sunday Monday Tuesday Wednesday Thursday Friday Saturday).each do |day| -%>
        <th><%= day %></th>
      <% end -%>
    </tr>
    
    <% @calendar.weeks.each do |week| -%>
    <tr>
      <% week.days.each do |day| -%>
      <td <%= raw date_class(day, @date) %> >
        <div class="date">
          <% if 1 == day.date.day %>
            <span class="month"><%= day.date.strftime("%B") %></span>
          <% end -%>
          <%= link_to day.date.day, calendar_day_path(:date => day.date) %>
        </div>
    		<div id="day-<%= day.date.strftime("%Y-%m-%d") %>">
        	<ul>
            <% for event in day.events %>
              <li><%= link_to h(event.name),
                friendly_page_path(event.page) %></li>
            <% end %>
          </ul>
    		</div>
      </td>
      <% end -%>
    </tr>
    <% end -%>

  </table>

</section>
